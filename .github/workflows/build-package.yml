# This is a test workflow
# Giving up on windows - works locally but not github!!??!!
name: build-package

on:
  push:
    branches: 
    - release/*
  pull_request:
    branches:
    - master

jobs:
  build-package:
    runs-on: ubuntu-latest
    steps:
    - name: Install WineHQ repo
      shell: bash
      run: |
        sudo dpkg --add-architecture i386
        wget -nc https://dl.winehq.org/wine-builds/winehq.key
        sudo apt-key add winehq.key 
        sudo apt-add-repository \
        'deb https://dl.winehq.org/wine-builds/ubuntu/ bionic main'
        sudo apt-get update
    - name: Install Wine dependencies ~ hick ~
      shell: bash
      run: >
        sudo apt-get -y install
        libgnutls30:i386
        libldap-2.4-2:i386
        libgpg-error0:i386
        libxml2:i386
        libasound2-plugins:i386
        libsdl2-2.0-0:i386
        libfreetype6:i386
        libdbus-1-3:i386
        libsqlite3-0:i386
    - name: Install Wine ~ hick hick ~
      shell: bash
      run: |
        sudo apt-get -y install --install-recommends wine-stable
        sudo apt-get -y install --install-recommends winehq-stable
    - name: Checkout PortableApps.comInstaller
      uses: actions/checkout@v2
      with: 
        repository: uroesch/PortableApps.comInstaller
        path: PortableApps.comInstaller
        ref: master
        lfs: true
    - name: Checkout PortableApps.comLauncher
      uses: actions/checkout@v2
      with: 
        repository: uroesch/PortableApps.comLauncher
        path: PortableApps.comLauncher
        ref: patched
        lfs: true
    - name: Checkout LdapAdminPortable
      uses: actions/checkout@v2
      with:
        path: LdapAdminPortable
    - name: Run Update.ps1
      shell: pwsh
      run: LdapAdminPortable/Other/Update/Update.ps1
      #    - name: Archive LdapAdminPortable as Zip
      #uses: thedoctor0/zip-release@master
      #with:
      #  filename: 'LdapAdminPortable.zip'
      #  exclusions: '*.git* Download'
      #    - name: Upload LdapAdminPortable Zip
      #uses: actions/upload-artifact@v1.0.0
      #with:
      #  name: LdapAdminPortable.zip
